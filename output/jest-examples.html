<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html lang="en">
    <head>
        <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
        <link href="/styles/site.css" rel="stylesheet" type="text/css"/>
        <!-- <link href="/styles/type-settings.css" rel="stylesheet" type="text/css"/> -->
        <link href="/css/type-settings.css" rel="stylesheet" type="text/css"/>
        <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
        <META name="Description" content="Apache OpenJPA -- JEST Examples" />
        <META name="Keywords" content="Apache OpenJPA, JPA, JPA 1.0, JSR-220, JPA2, JPA 2.0, JSR-317, " />
        <META name="Owner" content="dev@openjpa.apache.org" />
        <META name="Robots" content="index, follow" />
        <META name="Security" content="Public" />
        <META name="Source" content="wiki template" />
        <META name="DC.Date" scheme="iso8601" content="2010-08-11" />
        <META name="DC.Language" scheme="rfc1766" content="en" />
        <META name="DC.Rights" content="Copyright Â© 2006,2024 The Apache Software Foundation" />
        <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>
	<style>
.headerlink {
  visibility: hidden;
}
dt:hover > .headerlink, p:hover > .headerlink, td:hover > .headerlink, h1:hover > .headerlink, h2:hover > .headerlink, h3:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, h6:hover > .headerlink {
  visibility: visible
}	</style>
        <title>Apache OpenJPA -- JEST Examples</title>
    </head>
    <body>
        <div class="white_box">
            <div class="header">
                <div class="header_l">
                    <div class="header_r">
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content_l">
                    <div class="content_r">
                        <div>
                            <!-- Banner -->
                            <TABLE valign="top" border="0" cellspacing="0" cellpadding="5" width="100%" background="images/header-bg3.png">
                                <TR>
                                    <TD valing="top" align="left">
                                        <A href="https://openjpa.apache.org/"><IMG src="/images/openjpa-logo.png" border="0" alt="OpenJPA Logo"></A>
                                    </TD>
                                    <TD width="100%">
                                        &nbsp;
                                    </TD>
                                    <TD valing="top" align="right">
                                        <A href="https://www.apache.org/"><IMG src="/images/asf_logo_wide2.png" border="0" alt="ASF Logo"></A>
                                    </TD>
                                </TR>
                            </TABLE>

                            <!-- Navigation Bar -->
                            <div class="bottom_red_bar">
                                <div id="site-breadcrumbs">
                                </div>
                            </div>

                            <!-- Content -->
                            <table border="0">
                                <tbody>
                                    <tr>
                                        <td valign="top">
                                            <div class="navigation">
                                                <div class="navigation_top">
                                                    <div class="navigation_bottom">
                                                        <!-- NavigationBar -->
                                                        <h3><a name="SideNav-Overview"></a><a href="/overview.html" title="Overview">Overview</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/quick-start.html" title="Quick Start">Quick Start</a></li>
                                                            <li><a href="/downloads.html" title="Downloads">Downloads</a></li>
                                                            <li><a href="/documentation.html" title="Documentation">Documentation</a></li>
                                                            <li><a href="/site-index.html" title="Site Index">Site Index</a></li>
                                                            <li><a href="/license.html" title="License">License</a></li>
                                                            <li><a href="/privacy-policy.html" title="Privacy Policy">Privacy Policy</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Community"></a><a href="/community.html" title="Community">Community</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/index.html#Index-eventsandnews" title="Events and News">Events and News</a></li>
                                                            <li><a href="/found-a-bug.html" title="Found a Bug">Found a Bug</a>?</li>
                                                            <li><a href="/get-involved.html" title="Get Involved">Get Involved</a></li>
                                                            <li><a href="/mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                                                            <li><a href="/committers.html" title="Committers">Committers</a></li>
                                                            <li><a href="/integration.html" title="Integration">Integration</a></li>
                                                            <li><a href="/powered-by.html" title="Powered By">Powered By</a></li>
                                                            <li><a href="/thanks.html" title="Thanks">Thanks</a></li>
                                                        </ul>


                                                        <h3><a name="SideNav-Development"></a><a href="/development.html" title="Development">Development</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/downloads-nightly.html" title="Downloads">Nightly Downloads</a></li>                                        
                                                            <li><a href="/source-code.html" title="Source Code">Source Code</a></li>
                                                            <li><a href="/testing.html" title="Testing">Testing</a></li>
                                                            <li><a href="https://issues.apache.org/jira/browse/OPENJPA" class="external-link" rel="nofollow">Issue Tracker</a></li>
                                                            <li><a href="/tools.html" title="Tools">Tools</a></li>
                                                            <li><a href="/samples.html" title="Samples">Samples</a></li>
                                                            <li><a href="/release-management.html" title="Release Management">Release Management</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Consumers"></a><a href="/consumers.html" title="Consumers">Consumers</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/tips-n-techniques.html" title="Tips and Techniques">Tips and Techniques</a></li>
                                                            <li><a href="/troubleshoot.html" title="Trouble Shoot">Trouble Shoot</a></li>
                                                        </ul>

                                                        <h3>Search</h3>

                                                        <div style="padding: 5px 5px 0px 25px;">
                                                            <form action="https://www.google.com/search" method="get" style="font-size: 10px;">
                                                                <input name="ie" type="hidden" value="UTF-8">
                                                                <input name="oe" type="hidden" value="UTF-8">
                                                                <input maxlength="255" name="q" size="15" type="text" value=""><br><br>
                                                                <input name="btnG" type="submit" value="Google">
                                                                <input name="domains" type="hidden" value="openjpa.apache.org">
                                                                <input name="sitesearch" type="hidden" value="openjpa.apache.org">
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td valign="top" width="100%" style="overflow:hidden;">
                                            <div class="wiki-content">
    <p><a name="JESTExamples-JESTinAction"></a></p>
<h1 id="jest-in-action">JEST in Action<a class="headerlink" href="#jest-in-action" title="Permalink">&para;</a></h1>
<img height="800" src="images/welcome-page.JPG" width="1200"/>
<p><a name="JESTExamples-DescriptionofaSimpleJEST-enabledWebApplication"></a></p>
<h2 id="description-of-a-simple-jest-enabled-web-application">Description of a Simple JEST-enabled Web Application<a class="headerlink" href="#description-of-a-simple-jest-enabled-web-application" title="Permalink">&para;</a></h2>
<p>A sample is available to demonstrate JEST usage. You will find the example
in OpenJPA code repository under <strong>openjpa-examples/jest</strong> tree with its
source code and deployment descriptors <strong>WEB-INF/web.xml</strong> and
<strong>META-INF/persistence.xml</strong>. The example is a simple servlet
<strong>demo.SimpleApp</strong> that instantiates a persistent unit named <strong>estdemo</strong>
and populates a database with few sample records of two persistent entities
<strong>demo.Actor</strong> and <strong>demo.Movie</strong>.</p>
<p><a name="JESTExamples-PersistenceUnitInitialization"></a></p>
<h2 id="persistence-unit-initialization">Persistence Unit Initialization<a class="headerlink" href="#persistence-unit-initialization" title="Permalink">&para;</a></h2>
<p>The following code from  <strong>demo.SimpleApp</strong> shows the initialization
process at the servlet's <strong>init()</strong> method.</p>
<div style="border-style: solid;border-width: 0px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Simple Servlet initializes a pooled Persistent Unit</b></div>
<pre><code>public class SimpleApp extends HttpServlet {
    EntityManagerFactory _emf;
    private static String UNIT_NAME = "jestdemo";
    
    @Override 
    public void init(ServletConfig config) throws ServletException {
       super.init(config);
	    config.getServletContext().log("Initializing persistence unit [" + UNIT_NAME + "]");
	    try {
	        Map&lt;String,Object&gt; props = new HashMap&lt;String, Object&gt;();
    	    props.put("openjpa.EntityManagerFactoryPool", "true");
    	    _emf = Persistence.createEntityManagerFactory(UNIT_NAME,props);
	        new DataLoader().populate(_emf.createEntityManager());
    	} catch (Exception e) {
    	    throw new ServletException(e);
	    }
	    config.getServletContext().log("Initialized with persistence unit [" + UNIT_NAME + "]");
    }
</code></pre>
<p>It is <strong>important</strong> to notice that the persistent unit is instantiated so
that the <code>EntityManagerFactory</code> is pooled by OpenJPA. The way to achieve
that is to set configuration property <code>openjpa.EntityManagerFactoryPool</code>
to <strong>true</strong>. It is also important to note that this property is recognized
<em>only</em> when passed via runtime and <em>not</em> if it were specified in
<code>META-INF/persistence.xml</code> unlike other OpenJPA configuration properties.</p>
<p>Besides instantiating the persistent unit, the servlet does not do anything
else other than serving a welcome <em>index.html</em> web page as its
<em>doGet()</em> method shows:</p>
<div style="border-style: solid;border-width: 0px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>Simple Servlet that only serves a single index.html page</b></div>
<pre><code>/**
 * The only response by this application is an &lt;code&gt;index.html&lt;/code&gt; file.
 */
@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp)
        throws ServletException, IOException {
	resp.setContentType("text/html");
	OutputStream out = resp.getOutputStream();
	InputStream in = getClass().getResourceAsStream("index.html");
	for (int c = 0; (c = in.read()) != -1;) {
	    out.write((char)c);
	}
}
</code></pre>
<p><a name="JESTExamples-DeploymentDescriptortoenableJEST"></a></p>
<h2 id="deployment-descriptor-to-enable-jest">Deployment Descriptor to enable JEST<a class="headerlink" href="#deployment-descriptor-to-enable-jest" title="Permalink">&para;</a></h2>
<p>The sample web application deploys <em>demo.SimpleApp</em> servlet <em>and</em> JEST
servlet. The essential aspect of the deployment descriptor
<em>WEB-INF/web.xml</em> is shown below</p>
<div style="border-style: solid;border-width: 0px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;border-bottom-style: solid;"><b>web.xml deployment descriptor (edited version)</b></div>
<pre><code>&lt;web-app version="2.4" 
      xmlns="http://java.sun.com/xml/ns/j2ee" 
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
      xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
      http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"&gt;
    &lt;display-name&gt;Demo Application with JEST Servlet&lt;/display-name&gt;  
    &lt;welcome-file-list&gt;
        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
    &lt;/welcome-file-list&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;demo&lt;/servlet-name&gt;
        &lt;servlet-class&gt;demo.SimpleApp&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;demo&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;jest&lt;/servlet-name&gt;   
        &lt;servlet-class&gt;org.apache.openjpa.persistence.jest.JESTServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;persistence.unit&lt;/param-name&gt;
            &lt;param-value&gt;jestdemo&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;jest&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/jest/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
</code></pre>
<h2 id="discovery-of-persistent-unit">Discovery of Persistent Unit<a class="headerlink" href="#discovery-of-persistent-unit" title="Permalink">&para;</a></h2>
<p>As can be seen in <code>WEB-INF/web.xml</code> above, the JEST servlet
<code>org.apache.openjpa.persistence.jest.JESTServlet</code> needs to know the
persistent unit name <code>jestdemo</code> to <em>discover</em> the actual
<code>EntityManagerFactory</code> instantiated by its sibling <code>demo.SimpleApp</code>
servlet. This discovery of an <code>EntityManagerFactory</code> instantiated by
another component is possible because the said
<code>EntityManagerFactory</code> is being pooled by OpenJPA. A more general
discovery mechanics where JEST can discover a <code>EntityManagerFactory</code>
instantiated and injected by the container
would be available in future.</p>
<h2 id="building-the-sample-application">Building the sample application<a class="headerlink" href="#building-the-sample-application" title="Permalink">&para;</a></h2>
<p>An Ant build script <code>build.xml</code> is provided and a <code>build.properties</code> to
adjust for local settings. To suit your local environment, please edit the
<code>build.properties</code> for OpenJPA library and <code>META-INF/persistence.xml</code>
for database specifics. The supplied build file compiles two persistent
domain classes <code>demo.Actor</code> and <code>demo.Movie</code>, enhanced them and
packages them in an web archive <code>demo.war</code>. The script assumes that the
OpenJPA library and the JDBC driver (the sample persistence descriptor uses
MySQL, by deafult) are available in shared library of the Servlet Container
and hence does <em>not</em> package these libraries in the web archive
<code>demo.war</code>.</p>
<h2 id="deploying-the-sample-application">Deploying the sample application<a class="headerlink" href="#deploying-the-sample-application" title="Permalink">&para;</a></h2>
<p>The next step is to deploy this simple web archive <code>demo.war</code> in a
Servlet Container such as Tomcat or a a JEE container. We do not describe
these steps because they are fairly standard.</p>
<h2 id="jest-in-action_1">JEST in action<a class="headerlink" href="#jest-in-action_1" title="Permalink">&para;</a></h2>
<p>Once the sample web application is deployed, say in Tomcat running on
<code>localhost:8080</code>, open the web browser <a href="http://localhost:8080/demo">http://localhost:8080/demo</a> and
you should see the web page  served by <code>demo.SimpleApp</code>. This step
initializes <code>demo.SimpleApp</code> and hence the persistence unit <code>jestdemo</code>.</p>
<p>Now, if you go to URL <a href="http://localhost:8080/demo/jest/">http://localhost:8080/demo/jest/</a>, the JEST
welcome page will be displayed -- which is JavaScript enabled web page that
demonstrates currently available JEST facilities such as finding or
querying for instances.</p>
</div></div></div>
                                            </div>
                                        </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bottom_red_bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="black_box">
                    <div class="footer">
                        <div class="footer_l">
                            <div class="footer_r">
                                <div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="design_attribution">
                Copyright &copy; 2006,2024 The Apache Software Foundation. Licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.<br />
                Apache, the Apache feather logo and OpenJPA are trademarks of The Apache Software Foundation.<br />
                Other names may be trademarks of their respective owners.<br />
            </div>
    </body>
</html>