<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html lang="en">
    <head>
        <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
        <link href="/styles/site.css" rel="stylesheet" type="text/css"/>
        <!-- <link href="/styles/type-settings.css" rel="stylesheet" type="text/css"/> -->
        <link href="/css/type-settings.css" rel="stylesheet" type="text/css"/>
        <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
        <META name="Description" content="Apache OpenJPA -- OpenJPAEclipseEnhancementBuilder" />
        <META name="Keywords" content="Apache OpenJPA, JPA, JPA 1.0, JSR-220, JPA2, JPA 2.0, JSR-317, " />
        <META name="Owner" content="dev@openjpa.apache.org" />
        <META name="Robots" content="index, follow" />
        <META name="Security" content="Public" />
        <META name="Source" content="wiki template" />
        <META name="DC.Date" scheme="iso8601" content="2010-08-11" />
        <META name="DC.Language" scheme="rfc1766" content="en" />
        <META name="DC.Rights" content="Copyright Â© 2006,2025 The Apache Software Foundation" />
        <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>
	<style>
.headerlink {
  visibility: hidden;
}
dt:hover > .headerlink, p:hover > .headerlink, td:hover > .headerlink, h1:hover > .headerlink, h2:hover > .headerlink, h3:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, h6:hover > .headerlink {
  visibility: visible
}	</style>
        <title>Apache OpenJPA -- OpenJPAEclipseEnhancementBuilder</title>
    </head>
    <body>
        <div class="white_box">
            <div class="header">
                <div class="header_l">
                    <div class="header_r">
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content_l">
                    <div class="content_r">
                        <div>
                            <!-- Banner -->
                            <TABLE valign="top" border="0" cellspacing="0" cellpadding="5" width="100%" background="images/header-bg3.png">
                                <TR>
                                    <TD valing="top" align="left">
                                        <A href="https://openjpa.apache.org/"><IMG src="/images/openjpa-logo.png" border="0" alt="OpenJPA Logo"></A>
                                    </TD>
                                    <TD width="100%">
                                        &nbsp;
                                    </TD>
                                    <TD valing="top" align="right">
                                        <A href="https://www.apache.org/"><IMG src="/images/asf_logo_wide2.png" border="0" alt="ASF Logo"></A>
                                    </TD>
                                </TR>
                            </TABLE>

                            <!-- Navigation Bar -->
                            <div class="bottom_red_bar">
                                <div id="site-breadcrumbs">
                                </div>
                            </div>

                            <!-- Content -->
                            <table border="0">
                                <tbody>
                                    <tr>
                                        <td valign="top">
                                            <div class="navigation">
                                                <div class="navigation_top">
                                                    <div class="navigation_bottom">
                                                        <!-- NavigationBar -->
                                                        <h3><a name="SideNav-Overview"></a><a href="/overview.html" title="Overview">Overview</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/quick-start.html" title="Quick Start">Quick Start</a></li>
                                                            <li><a href="/downloads.html" title="Downloads">Downloads</a></li>
                                                            <li><a href="/documentation.html" title="Documentation">Documentation</a></li>
                                                            <li><a href="/site-index.html" title="Site Index">Site Index</a></li>
                                                            <li><a href="/license.html" title="License">License</a></li>
                                                            <li><a href="/privacy-policy.html" title="Privacy Policy">Privacy Policy</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Community"></a><a href="/community.html" title="Community">Community</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/index.html#Index-eventsandnews" title="Events and News">Events and News</a></li>
                                                            <li><a href="/found-a-bug.html" title="Found a Bug">Found a Bug</a>?</li>
                                                            <li><a href="/get-involved.html" title="Get Involved">Get Involved</a></li>
                                                            <li><a href="/mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                                                            <li><a href="/committers.html" title="Committers">Committers</a></li>
                                                            <li><a href="/integration.html" title="Integration">Integration</a></li>
                                                            <li><a href="/powered-by.html" title="Powered By">Powered By</a></li>
                                                            <li><a href="/thanks.html" title="Thanks">Thanks</a></li>
                                                        </ul>


                                                        <h3><a name="SideNav-Development"></a><a href="/development.html" title="Development">Development</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/downloads-nightly.html" title="Downloads">Nightly Downloads</a></li>                                        
                                                            <li><a href="/source-code.html" title="Source Code">Source Code</a></li>
                                                            <li><a href="/testing.html" title="Testing">Testing</a></li>
                                                            <li><a href="https://issues.apache.org/jira/browse/OPENJPA" class="external-link" rel="nofollow">Issue Tracker</a></li>
                                                            <li><a href="/tools.html" title="Tools">Tools</a></li>
                                                            <li><a href="/samples.html" title="Samples">Samples</a></li>
                                                            <li><a href="/release-management.html" title="Release Management">Release Management</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Consumers"></a><a href="/consumers.html" title="Consumers">Consumers</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/tips-n-techniques.html" title="Tips and Techniques">Tips and Techniques</a></li>
                                                            <li><a href="/troubleshoot.html" title="Trouble Shoot">Trouble Shoot</a></li>
                                                        </ul>

                                                        <h3>Search</h3>

                                                        <div style="padding: 5px 5px 0px 25px;">
                                                            <form action="https://www.google.com/search" method="get" style="font-size: 10px;">
                                                                <input name="ie" type="hidden" value="UTF-8">
                                                                <input name="oe" type="hidden" value="UTF-8">
                                                                <input maxlength="255" name="q" size="15" type="text" value=""><br><br>
                                                                <input name="btnG" type="submit" value="Google">
                                                                <input name="domains" type="hidden" value="openjpa.apache.org">
                                                                <input name="sitesearch" type="hidden" value="openjpa.apache.org">
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td valign="top" width="100%" style="overflow:hidden;">
                                            <div class="wiki-content">
    <p><a name="OpenJPAEclipseEnhancementBuilder-OpenJPAEclipseTooling"></a></p>
<h1 id="openjpa-eclipse-tooling">OpenJPA Eclipse Tooling<a class="headerlink" href="#openjpa-eclipse-tooling" title="Permalink">&para;</a></h1>
<p><a name="OpenJPAEclipseEnhancementBuilder-HowtousetheOpenJPAEclipseToolingBuilderforBytecodeEnhancement"></a></p>
<h2 id="how-to-use-the-openjpa-eclipse-tooling-builder-for-bytecode-enhancement">How to use the OpenJPA Eclipse Tooling Builder for Bytecode Enhancement<a class="headerlink" href="#how-to-use-the-openjpa-eclipse-tooling-builder-for-bytecode-enhancement" title="Permalink">&para;</a></h2>
<p>Once you have <a href="openjpaeclipseinstallation.html">installed the OpenJPA Eclipse tooling</a>
, here is how to add the Bytecode Enhancement Builder to a Java project:</p>
<ol>
<li>right-click on Project, click "Add/Remove Bytecode Enhancer"</li>
<li>in the Enable OpenJPA dialog which will be shown: (TBD: Attach screenshot
here, once ugly <a href="https://issues.apache.org/jira/browse/OPENJPA-1521">OPENJPA-1521</a>
is resolved?)
<ol>
<li>choose if OpenJPA libraries should be added to project, this will copy
the OpenJPA JARs from the Eclipse plug-in into a lib directory of the Java
project, and add them as Referenced Libraries. (In a normal existing
project you'll already have them via Maven or whatever so you'll not use /
want to deactivate this; for new or test projects this is convenient.)</li>
<li>choose enhancement options, if you need any. These are the <a href="http://openjpa.apache.org/builds/latest/docs/manual/ref_guide_pc_enhance.html#ref_guide_pc_enhance_build">same options as the CLI PCEnhancer supports</a>
.</li>
</ol>
</li>
<li>menu Project &gt; Properties (or right-click on Project &gt; Properties) should
now show the "OpenJPA PC-Enhancer Project Builder" added after the usual
"Java Builder"</li>
<li>when Eclipse builds (compiles) the project, classes will now be byte-code
enhanced</li>
</ol>
<p><a name="OpenJPAEclipseEnhancementBuilder-KnownLimitations"></a></p>
<h3 id="known-limitations">Known Limitations<a class="headerlink" href="#known-limitations" title="Permalink">&para;</a></h3>
<ul>
<li>persistence.xml is ignored, the plug-in / builder only looks for
annotations (@Entity, @MappedSuperclass, @Embeddable, @ManagedInterface) to
decide if a class actually needs enhancement</li>
<li>any error markers (the lines shown in the Problems view) are on the
.class resource, instead of on the source .java class, which would be more
convenient</li>
<li>the Builder runs even on classes which are red and compilation issues,
because the Eclipse compiler still tries to produce a .class file, and may
log weird error messages in that case</li>
</ul>
<p><a name="OpenJPAEclipseEnhancementBuilder-Troubleshooting,Tips&amp;Recommendations"></a></p>
<h3 id="troubleshooting-tips-recommendations">Troubleshooting, Tips &amp; Recommendations<a class="headerlink" href="#troubleshooting-tips-recommendations" title="Permalink">&para;</a></h3>
<ul>
<li>
<p>If the Builder has trouble during enhancement, it normally logs useful
messages / exception stack traces to the Eclipse Error Log. Use menu Window
&gt; Show View &gt; Error Log to display it. If you don't have the Error Log
view, this could be because you have an Eclipse with the PDE (Plug-in
Development Environment), get that. The Eclipse Error Log can also be
exported from this view, e.g. to send it to the mailing list.  Further
debugging &amp; informational log messages can be enabled via the .project
file, see below.</p>
</li>
<li>
<p>If your Eclipse dies due to "java.lang.OutOfMemoryError: Java heap space"
/ "java.lang.OutOfMemoryError: PermGen space" issues, you may need to add
e.g. "-XX:PermSize=64m -XX:MaxPermSize=256m -Xms128m -Xmx512m" to your
eclipse.ini (each option on a separate line) for the enhancement builder</p>
</li>
<li>
<p>In order to be sure that you're actually using build time enhancement,
and not enhancing dynamically at run-time, you may wish to set the
openjpa.RuntimeUnenhancedClasses=unsupported property in your
persistence.xml or wherever you bootstrap OpenJPA (see <a href="http://openjpa.apache.org/builds/latest/docs/manual/ref_guide_pc_enhance.html#ref_guide_pc_enhance_unenhanced_types">Omitting the OpenJPA enhancer</a>
)</p>
</li>
</ul>
<p><a name="OpenJPAEclipseEnhancementBuilder-Options"></a></p>
<h3 id="options">Options<a class="headerlink" href="#options" title="Permalink">&para;</a></h3>
<ul>
<li>
<p>More verbose logging for the Builder can be enabled via a configuration
option in .project.  This option is only intended for troubleshooting &amp;
debugging, because it seems to significantly (!) slow down the builder, and
something goes wrong with the Progress view (Monitor stuff) causing it to
not update correctly anymore, and appear to keep running (although it's
not).</p>
<pre><code>  &lt;projectDescription&gt;
  ...
  &lt;buildSpec&gt;
  ...
  &lt;buildCommand&gt;
      &lt;name&gt;org.apache.openjpa.eclipse.OpenJPAEnhancerBuilder&lt;/name&gt;
      &lt;arguments&gt;
  	&lt;dictionary&gt;
  	    &lt;key&gt;debugLogs&lt;/key&gt;
  	    &lt;value&gt;true&lt;/value&gt;
  	&lt;/dictionary&gt;
</code></pre>
<p>The debugLogs = true will lead to message such as these to be shown in the
Error Log (the order sometimes appears to get messed up) :</p>
<pre><code>  OpenJPA Enhancement (Full Build, collecting resources) took 0ms, found 3 classes potentially needing enhancement
  OpenJPA Enhancer ran on but did not have to bytecode enhance /test-project/bin/ch.vorburger.jpa/SomeEntityTest.class
  OpenJPA Enhancer ran on and actually bytecode enhanced /test-project/bin/ch.vorburger.jpa/SomeEntity.class
  OpenJPA Enhancer ran on but did not have to bytecode enhance /test-again/bin/ch.vorburger.jpa/NotToEnhance.class
  OpenJPA Enhancement (Full Build) took 47ms, for 3 potential classes, of which 1 were actually enhanced
</code></pre>
</li>
<li>
<p>The builder has been written with efficiency in mind and underwent some
profiling &amp; optimization, e.g. it correctly does only Incremental Builds
when possible.	However, for projects with a lot of classes, this Builder
may slow down the project. This is because it still has to byte-code
inspect (load and analyze) each .class to determine if it needs
enhancement.  If the JPA entities in your project follow some naming
convention (e.g. all ending in *Entity, or all in a certain package), then
the builder can be configured to "match" only certain classes using
Ant-like patterns, by manually adding the following to the existing
.project file of the Eclipse Java project:</p>
<pre><code>  &lt;projectDescription&gt;
  ...
  &lt;buildSpec&gt;
  ...
  &lt;buildCommand&gt;
      &lt;name&gt;org.apache.openjpa.eclipse.OpenJPAEnhancerBuilder&lt;/name&gt;
      &lt;arguments&gt;
  	&lt;dictionary&gt;
  	    &lt;key&gt;include1&lt;/key&gt;
  	    &lt;value&gt;**/*Entity.class&lt;/value&gt;
  	&lt;/dictionary&gt;
  	&lt;dictionary&gt;
  	    &lt;key&gt;include2&lt;/key&gt;
  	    &lt;value&gt;**/*EntityRef.class&lt;/value&gt;
  	&lt;/dictionary&gt;
</code></pre>
</li>
<li>
<p>The above two options can be mixed by adding several <code>&lt;dictionary&gt;</code> inside the <code>&lt;arguments&gt;</code>.</p>
</li>
</ul>

                                            </div>
                                        </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bottom_red_bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="black_box">
                    <div class="footer">
                        <div class="footer_l">
                            <div class="footer_r">
                                <div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="design_attribution">
                Copyright &copy; 2006,2025 The Apache Software Foundation. Licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.<br />
                Apache, the Apache feather logo and OpenJPA are trademarks of The Apache Software Foundation.<br />
                Other names may be trademarks of their respective owners.<br />
            </div>
    </body>
</html>