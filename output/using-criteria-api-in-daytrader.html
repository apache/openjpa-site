<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<html lang="en">
    <head>
        <META http-equiv="Content-Type" content="text/html;charset=UTF-8" />
        <link href="/styles/site.css" rel="stylesheet" type="text/css"/>
        <!-- <link href="/styles/type-settings.css" rel="stylesheet" type="text/css"/> -->
        <link href="/css/type-settings.css" rel="stylesheet" type="text/css"/>
        <LINK rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
        <META name="Description" content="Apache OpenJPA -- Using Criteria API in DayTrader" />
        <META name="Keywords" content="Apache OpenJPA, JPA, JPA 1.0, JSR-220, JPA2, JPA 2.0, JSR-317, " />
        <META name="Owner" content="dev@openjpa.apache.org" />
        <META name="Robots" content="index, follow" />
        <META name="Security" content="Public" />
        <META name="Source" content="wiki template" />
        <META name="DC.Date" scheme="iso8601" content="2010-08-11" />
        <META name="DC.Language" scheme="rfc1766" content="en" />
        <META name="DC.Rights" content="Copyright Â© 2006,2024 The Apache Software Foundation" />
        <META http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html" l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html" l gen true r (n 0 s 0 v 0 l 0) "http://www.classify.org/safesurf/" l gen true r (SS~~000 1))'/>
	<style>
.headerlink {
  visibility: hidden;
}
dt:hover > .headerlink, p:hover > .headerlink, td:hover > .headerlink, h1:hover > .headerlink, h2:hover > .headerlink, h3:hover > .headerlink, h4:hover > .headerlink, h5:hover > .headerlink, h6:hover > .headerlink {
  visibility: visible
}	</style>
        <title>Apache OpenJPA -- Using Criteria API in DayTrader</title>
    </head>
    <body>
        <div class="white_box">
            <div class="header">
                <div class="header_l">
                    <div class="header_r">
                    </div>
                </div>
            </div>
            <div class="content">
                <div class="content_l">
                    <div class="content_r">
                        <div>
                            <!-- Banner -->
                            <TABLE valign="top" border="0" cellspacing="0" cellpadding="5" width="100%" background="images/header-bg3.png">
                                <TR>
                                    <TD valing="top" align="left">
                                        <A href="https://openjpa.apache.org/"><IMG src="/images/openjpa-logo.png" border="0" alt="OpenJPA Logo"></A>
                                    </TD>
                                    <TD width="100%">
                                        &nbsp;
                                    </TD>
                                    <TD valing="top" align="right">
                                        <A href="https://www.apache.org/"><IMG src="/images/asf_logo_wide2.png" border="0" alt="ASF Logo"></A>
                                    </TD>
                                </TR>
                            </TABLE>

                            <!-- Navigation Bar -->
                            <div class="bottom_red_bar">
                                <div id="site-breadcrumbs">
                                </div>
                            </div>

                            <!-- Content -->
                            <table border="0">
                                <tbody>
                                    <tr>
                                        <td valign="top">
                                            <div class="navigation">
                                                <div class="navigation_top">
                                                    <div class="navigation_bottom">
                                                        <!-- NavigationBar -->
                                                        <h3><a name="SideNav-Overview"></a><a href="/overview.html" title="Overview">Overview</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/quick-start.html" title="Quick Start">Quick Start</a></li>
                                                            <li><a href="/downloads.html" title="Downloads">Downloads</a></li>
                                                            <li><a href="/documentation.html" title="Documentation">Documentation</a></li>
                                                            <li><a href="/site-index.html" title="Site Index">Site Index</a></li>
                                                            <li><a href="/license.html" title="License">License</a></li>
                                                            <li><a href="/privacy-policy.html" title="Privacy Policy">Privacy Policy</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Community"></a><a href="/community.html" title="Community">Community</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/index.html#Index-eventsandnews" title="Events and News">Events and News</a></li>
                                                            <li><a href="/found-a-bug.html" title="Found a Bug">Found a Bug</a>?</li>
                                                            <li><a href="/get-involved.html" title="Get Involved">Get Involved</a></li>
                                                            <li><a href="/mailing-lists.html" title="Mailing Lists">Mailing Lists</a></li>
                                                            <li><a href="/committers.html" title="Committers">Committers</a></li>
                                                            <li><a href="/integration.html" title="Integration">Integration</a></li>
                                                            <li><a href="/powered-by.html" title="Powered By">Powered By</a></li>
                                                            <li><a href="/thanks.html" title="Thanks">Thanks</a></li>
                                                        </ul>


                                                        <h3><a name="SideNav-Development"></a><a href="/development.html" title="Development">Development</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/downloads-nightly.html" title="Downloads">Nightly Downloads</a></li>                                        
                                                            <li><a href="/source-code.html" title="Source Code">Source Code</a></li>
                                                            <li><a href="/testing.html" title="Testing">Testing</a></li>
                                                            <li><a href="https://issues.apache.org/jira/browse/OPENJPA" class="external-link" rel="nofollow">Issue Tracker</a></li>
                                                            <li><a href="/tools.html" title="Tools">Tools</a></li>
                                                            <li><a href="/samples.html" title="Samples">Samples</a></li>
                                                            <li><a href="/release-management.html" title="Release Management">Release Management</a></li>
                                                        </ul>

                                                        <h3><a name="SideNav-Consumers"></a><a href="/consumers.html" title="Consumers">Consumers</a></h3>

                                                        <ul class="alternate" type="square">
                                                            <li><a href="/tips-n-techniques.html" title="Tips and Techniques">Tips and Techniques</a></li>
                                                            <li><a href="/troubleshoot.html" title="Trouble Shoot">Trouble Shoot</a></li>
                                                        </ul>

                                                        <h3>Search</h3>

                                                        <div style="padding: 5px 5px 0px 25px;">
                                                            <form action="https://www.google.com/search" method="get" style="font-size: 10px;">
                                                                <input name="ie" type="hidden" value="UTF-8">
                                                                <input name="oe" type="hidden" value="UTF-8">
                                                                <input maxlength="255" name="q" size="15" type="text" value=""><br><br>
                                                                <input name="btnG" type="submit" value="Google">
                                                                <input name="domains" type="hidden" value="openjpa.apache.org">
                                                                <input name="sitesearch" type="hidden" value="openjpa.apache.org">
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                        <td valign="top" width="100%" style="overflow:hidden;">
                                            <div class="wiki-content">
    <p><a name="UsingCriteriaAPIinDayTrader-UsingCriteriaAPIinDayTrader"></a></p>
<h1 id="using-criteria-api-in-daytrader">Using Criteria API in DayTrader<a class="headerlink" href="#using-criteria-api-in-daytrader" title="Permalink">&para;</a></h1>
<p>A current DayTrader project implementation in Apache Geronimo contains
several JPQL queries. These can easily be converted to JPA Criteria API
queries. A sample with this conversion can be created to run on either the
Apache Geronimo server or the WebSphere Application Server with the
built-in Derby database.</p>
<p><a name="UsingCriteriaAPIinDayTrader-DownloadingDayTrader"></a></p>
<h2 id="downloading-daytrader">Downloading DayTrader<a class="headerlink" href="#downloading-daytrader" title="Permalink">&para;</a></h2>
<p>You must have Subversion installed in order to download the DayTrader implementation.Subversion can be downloaded from&nbsp;<a href="http://subversion.apache.org/packages.html">http://subversion.apache.org/packages.html</a>
. Use the 2.1.3 version of DayTrader for this sample. Follow the following steps:</p>
<ol>
<li>
<p>Create a root directory for the download. For this example, we will use a directory called <em>DayTrader</em>.</p>
</li>
<li>
<p>Create subdirectories <strong>branches/2.1.3</strong> under the <strong>DayTrader</strong> directory</p>
</li>
<li>
<p>cd to <strong>DayTrader</strong></p>
</li>
<li>
<p>Issue the following subversion command:</p>
<pre><code> svn checkout https://svn.apache.org/repos/asf/geronimo/daytrader/branches/2.1.3 branches/2.1.3 .
</code></pre>
</li>
</ol>
<p><a name="UsingCriteriaAPIinDayTrader-BuildDayTrader"></a></p>
<h2 id="build-daytrader">Build DayTrader<a class="headerlink" href="#build-daytrader" title="Permalink">&para;</a></h2>
<p>You must have maven installed in order to build DayTrader. Maven can be downloaded from <a href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a>. Unzip the file to a directory and run mvn.bat|.sh in the bin
subdirectory to install. Add the bin subdirectory to you system path.</p>
<p>Maven needs a repository. Typically it is at the following:</p>
<ul>
<li><strong>Windows</strong> - C:\Documents and Settings&lt;userid&gt;.m2\repository</li>
<li><strong>Linux/unix</strong> - ~/.m2/repository</li>
</ul>
<p>From the <strong>DayTrader/branches/2.1.3</strong> directory, type "mvn clean install" to build the project. (Note: If you see errors that say "java.util.zip.ZipException: error in opening zip file", ignore them for this exercise.)</p>
<p><a name="UsingCriteriaAPIinDayTrader-ApplytheDayTraderPatch"></a></p>
<h2 id="apply-the-daytrader-patch">Apply the DayTrader Patch<a class="headerlink" href="#apply-the-daytrader-patch" title="Permalink">&para;</a></h2>
<p>The following patch can be applied using a system or downloaded <em>patch</em> utility. (For example, you can get a patch utility for Windows from&nbsp;<a href="http://gnuwin32.sourceforge.net/packages/patch.htm">http://gnuwin32.sourceforge.net/packages/patch.htm</a>
.)</p>
<ul>
<li>Geronimo - <a href="artifacts/daytrader_geronimo.patch">daytrader_geronimo.patch</a></li>
<li>WebSphere - <a href="artifacts/daytrader_websphere.patch">daytrader_websphere.patch</a></li>
</ul>
<p>Download the appropriate patch and go to the <em>DayTrader/branches.2.1.3</em>
directory to apply it. For example, with the patch utility mentioned above,
you can type:</p>
<pre><code>patch \-p0 \-i &lt;path-to&gt;/daytrader_geronimo.patch
</code></pre>
<p>After you have applied the patch, you can see the changes from JPQL to the Criteria API in the java class org.apache.geronimo.samples.daytrader.ejb3.TradeSLSBBean. The changes are in the following 4 methods:</p>
<ul>
<li>getMarketSummary()</li>
<li>getClosedOrders()</li>
<li>getAllQuotes()</li>
<li>getHoldings()</li>
</ul>
<p>(Note: If you view these changes in eclipse, and you have previously run
"mvn eclipse:eclipse" to setup eclipse projects, you'll have to run this
command again in order for this file to compile.)</p>
<p>You can also <a href="apply-an-eclipse-patch.html">Apply an Eclipse Patch</a></p>
<p><a name="UsingCriteriaAPIinDayTrader-Re-createtheDayTraderearfile"></a></p>
<h2 id="re-create-the-daytrader-ear-file">Re-create the DayTrader ear file<a class="headerlink" href="#re-create-the-daytrader-ear-file" title="Permalink">&para;</a></h2>
<p>From the <strong>DayTrader/branches/2.1.3</strong> directory, type "mvn clean install" to build the project.</p>
<p><a name="UsingCriteriaAPIinDayTrader-RunDayTraderonGeronimo"></a></p>
<h2 id="run-daytrader-on-geronimo">Run DayTrader on Geronimo<a class="headerlink" href="#run-daytrader-on-geronimo" title="Permalink">&para;</a></h2>
<p>This writeup assumes some familiarity with Apache Geronimo. The download
and documentation can be found at <a href="http://geronimo.apache.org/">http://geronimo.apache.org.</a></p>
<p>Install and start the Geronimo server.</p>
<p>Add jpa2 plugins from repository <a href="http://geronimo.apache.org/plugins/openjpa2">http://geronimo.apache.org/plugins/openjpa2</a>. One way to do this is the following:</p>
<ol>
<li>Go to the Geronimo console at http://<host>:8080/console and logon</host></li>
<li>Select <em>plugins</em></li>
<li>Click on <em>Add Repository</em> and add <a href="http://geronimo.apache.org/plugins/openjpa2">http://geronimo.apache.org/plugins/openjpa2</a></li>
<li>Click on <em>Update Repository List</em></li>
<li>Make sure the new repository is selected. Then click on <em>Show Plugins in selected repository.</em> On that panel:
<ol>
<li>Select <em>GeronimoPlugins, OpenJPA2::CAR 2.1.3-SNAPSHOT</em> and <em>GeronimoPlugins, OpenJPA2::Deployer 2.1.3-SNAPSHOT</em></li>
<li>Click on <em>Install</em></li>
</ol>
</li>
<li>On the next screen, click on <em>Install</em></li>
</ol>
<p>Deploy the DayTrader application. This can be done through the console as follows:</p>
<ol>
<li>Click on <em>Deploy New</em></li>
<li>For <em>Archive</em>, browse to DayTrader/branches/2.1.3/modules/ear/target/daytrader-ear-2.1.3.ear</li>
<li>For <em>Plan,</em> browse to DayTrader/branches/2.1.3/plans/dayTrader-derby-plan.xml</li>
<li>Check <em>Start app after install</em></li>
<li>Click on <em>Install</em></li>
</ol>
<p>Re-start the server.</p>
<p>Make sure that the system module, org.apache.geronimo.configs/axis-deployer/2.1.5/car, is running.</p>
<p>Run DayTrader:</p>
<ol>
<li>Go to http://<host>:8080/daytrader/</host></li>
<li>Click on the <em>Configuration</em> tab and click on <em>(Re)-create DayTrader Database Tables and Indexes</em></li>
<li>Click on the <em>Configuration&nbsp;</em> tab and click on <em>(Re)-populate DayTrader Database</em></li>
<li>Click on the <em>Trading &amp; Portfolios</em> tab, login, and start trading</li>
</ol>
<p><a name="UsingCriteriaAPIinDayTrader-RunDayTraderonWebSphere"></a></p>
<h2 id="run-daytrader-on-websphere">Run DayTrader on WebSphere<a class="headerlink" href="#run-daytrader-on-websphere" title="Permalink">&para;</a></h2>
<p>This writeup assumes some familiarity with WebSphere. Also, the script that
is provided assumes a local unmanaged node with a single server.</p>
<p>At a minimum, the WebSphere Application Server must be at version 7.0.0.9.
You must also have installed the Feature Pack for OSGi Applications and
Java Persistence API 2.0. Make sure you have a profile that is augmented
for JPA 2.0 function.</p>
<p>Download the following jython script. This script is used to configure the
objects needed by DayTrader (data sources, JMS queues and topics) and
install the application.</p>
<p><a href="artifacts/daytrader_singleserver.py">daytrader_singleServer.py</a></p>
<p>Within the bin directory of the augmented profile:</p>
<ol>
<li>
<p>Start the server.</p>
</li>
<li>
<p>Run the script using the following command:</p>
<pre><code> wsadmin -f &lt;location ofdaytrader_singleServer.py&gt; ${script options}
</code></pre>
<p>You can display the list of available script options by specifying the option "--help".</p>
</li>
<li>
<p>Re-start the server.</p>
</li>
</ol>
<p>Run DayTrader</p>
<ol>
<li>On a web browser, go to <a href="http://localhost">http://localhost</a>:<application-port>/daytrader/ (The default application port is 9080. But, you may have a different one if you created a new profile.)</application-port></li>
<li>Click on the <em>Configuration</em> tab and click on <em>(Re)-create  DayTrader Database Tables and Indexes</em></li>
<li>Click on the <em>Configuration&nbsp;</em> tab and click on <em>(Re)-populate DayTrader Database</em></li>
<li>Click on the <em>Trading &amp; Portfolios</em> tab, login, and start  trading</li>
</ol>

                                            </div>
                                        </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="bottom_red_bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="black_box">
                    <div class="footer">
                        <div class="footer_l">
                            <div class="footer_r">
                                <div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="design_attribution">
                Copyright &copy; 2006,2024 The Apache Software Foundation. Licensed under <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.<br />
                Apache, the Apache feather logo and OpenJPA are trademarks of The Apache Software Foundation.<br />
                Other names may be trademarks of their respective owners.<br />
            </div>
    </body>
</html>